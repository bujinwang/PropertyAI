// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model with role-based access
model User {
  id                       String                    @id @default(uuid())
  email                    String                    @unique
  password                 String
  firstName                String
  lastName                 String
  phone                    String?
  // This 'role' field uses an enum for a simple, single-role system.
  // It defaults to TENANT.
  role                     UserRole                  @default(TENANT)
  mfaEnabled               Boolean                   @default(false)
  mfaSecret                String?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  lastLogin                DateTime?
  isActive                 Boolean                   @default(true)
  passwordResetToken       String?
  passwordResetExpires     DateTime?
  failedLoginAttempts      Int                       @default(0)
  isLocked                 Boolean                   @default(false)
  lockedUntil              DateTime?
  lastLockedAt             DateTime?
  propertiesManaged        Property[]                @relation("PropertyManager")
  propertiesOwned          Property[]                @relation("PropertyOwner")
  units                    Unit[]                    @relation("UnitTenant")
  documents                Document[]
  maintenanceRequests      MaintenanceRequest[]      @relation("RequestedBy")
  sentMessages             Message[]                 @relation("SentMessages")
  receivedMessages         Message[]                 @relation("ReceivedMessages")
  notifications            Notification[]
  listings                 Listing[]
  applications             Application[]
  oauthConnections         OAuthConnection[]
  vendorPerformanceRatings VendorPerformanceRating[]
  auditEntries             AuditEntry[]
  leases                   Lease[]
  vendor                   Vendor?
  tenantIssuePredictions   TenantIssuePrediction[]
  escalationPolicyRules    EscalationPolicyRule[]
  onCallRotations          OnCallRotation[]
  apiKeys                  ApiKey[]
  // This 'roles' field establishes a many-to-many relationship with the Role model.
  // A user can have multiple roles, and a role can be assigned to many users.
  // Prisma implicitly creates a join table named `_RoleToUser` to manage this.
  roles                    Role[]
  consents                 Consent[]
  settings                 Json? // New field to store user settings as JSON
  refreshToken             String?
  pushToken                String?
  stripeCustomerId         String?                   @unique
  devices                  Device[]
  tenantRatings            TenantRating[]            @relation("RatedTenant")
  ratedTenantRatings       TenantRating[]            @relation("Rater")
  WhiteLabelConfig         WhiteLabelConfig[]

  @@index([role])
  @@index([isActive])
  @@index([email])
}

enum UserRole {
  ADMIN
  PROPERTY_MANAGER
  TENANT
  USER
  VENDOR
}

// Property model
model Property {
  id                  String               @id @default(uuid())
  name                String
  address             String
  city                String
  state               String
  zipCode             String
  country             String
  description         String?
  propertyType        PropertyType
  yearBuilt           Int?
  totalUnits          Int
  amenities           Json? // Stores amenities as JSON
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  isActive            Boolean              @default(true)
  manager             User                 @relation("PropertyManager", fields: [managerId], references: [id])
  managerId           String
  owner               User                 @relation("PropertyOwner", fields: [ownerId], references: [id])
  ownerId             String
  units               Unit[]
  documents           Document[]
  maintenanceRequests MaintenanceRequest[]
  images              PropertyImage[] // Relation to property images
  latitude            Float?
  longitude           Float?
  listings            Listing[]
  businessHours       BusinessHours[]
  emergencyProtocols  EmergencyProtocol[]
  escalationPolicies  EscalationPolicy[]
  onCallSchedules     OnCallSchedule[]
  whiteLabelConfig    WhiteLabelConfig?    @relation(fields: [whiteLabelConfigId], references: [id])
  whiteLabelConfigId  String?

  @@index([city])
  @@index([state])
  @@index([zipCode])
  @@index([propertyType])
}

enum PropertyType {
  APARTMENT
  HOUSE
  CONDO
  TOWNHOUSE
  COMMERCIAL
  INDUSTRIAL
  OTHER
}

// PropertyImage model for storing property images
model PropertyImage {
  id               Int      @id @default(autoincrement())
  propertyId       String
  property         Property @relation(fields: [propertyId], references: [id])
  filename         String // Stored filename
  originalFilename String // Original filename when uploaded
  mimetype         String // File MIME type
  size             Int // File size in bytes
  url              String // Full URL to access the image
  isFeatured       Boolean  @default(false) // Is this the main/featured image
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

// Unit model
model Unit {
  id                    String                  @id @default(uuid())
  unitNumber            String
  floorNumber           Int?
  size                  Float? // in square feet/meters
  bedrooms              Int?
  bathrooms             Float? // 1.5, 2, etc.
  rent                  Float?
  deposit               Float?
  isAvailable           Boolean                 @default(true)
  dateAvailable         DateTime?
  features              Json? // Stores features as JSON
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  property              Property                @relation(fields: [propertyId], references: [id])
  propertyId            String
  tenant                User?                   @relation("UnitTenant", fields: [tenantId], references: [id])
  tenantId              String?
  lease                 Lease?
  maintenanceRequests   MaintenanceRequest[]
  images                UnitImage[] // Relation to unit images
  listing               Listing?                @relation(fields: [listingId], references: [id])
  listingId             String?
  predictiveMaintenance PredictiveMaintenance[]
  appliances            Appliance[]

  @@index([isAvailable])
  @@index([rent])
}

// UnitImage model for storing unit images
model UnitImage {
  id               Int      @id @default(autoincrement())
  unitId           String
  unit             Unit     @relation(fields: [unitId], references: [id])
  filename         String // Stored filename
  originalFilename String // Original filename when uploaded
  mimetype         String // File MIME type
  size             Int // File size in bytes
  url              String // Full URL to access the image
  isFeatured       Boolean  @default(false) // Is this the main/featured image
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

// Lease model
model Lease {
  id              String         @id @default(uuid())
  startDate       DateTime
  endDate         DateTime
  rentAmount      Float
  securityDeposit Float
  leaseTerms      String?        @db.Text
  status          LeaseStatus    @default(ACTIVE)
  signedDate      DateTime       @default(now())
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  unit            Unit           @relation(fields: [unitId], references: [id])
  unitId          String         @unique
  tenant          User           @relation(fields: [tenantId], references: [id])
  tenantId        String
  documents       Document[]
  transactions    Transaction[]
  renewalDate     DateTime?
  ratings         TenantRating[]
}

enum LeaseStatus {
  PENDING
  ACTIVE
  EXPIRED
  TERMINATED
}

// Document model
model Document {
  id                   String              @id @default(uuid())
  name                 String
  type                 DocumentType
  url                  String // S3 or other storage URL
  uploadedAt           DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  description          String?
  property             Property?           @relation(fields: [propertyId], references: [id])
  propertyId           String?
  lease                Lease?              @relation(fields: [leaseId], references: [id])
  leaseId              String?
  uploadedBy           User                @relation(fields: [uploadedById], references: [id])
  uploadedById         String
  maintenanceRequest   MaintenanceRequest? @relation(fields: [maintenanceRequestId], references: [id])
  maintenanceRequestId String?
  size                 Int? // Size in bytes
  mimeType             String?
  isArchived           Boolean             @default(false)
}

enum DocumentType {
  LEASE
  INVOICE
  RECEIPT
  MAINTENANCE_REPORT
  PROPERTY_PHOTO
  CONTRACT
  OTHER
}

model Vendor {
  id                      String                    @id @default(uuid())
  name                    String
  contactPerson           User?                     @relation(fields: [contactPersonId], references: [id])
  contactPersonId         String?                   @unique
  phone                   String
  email                   String                    @unique
  address                 String
  specialty               String // e.g., Plumbing, Electrical
  workOrders              WorkOrderAssignment[]
  quotes                  WorkOrderQuote[]
  emergencyRoutingRules   EmergencyRoutingRule[]
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  serviceAreas            String[]
  availability            String
  certifications          String[]
  standardRate            Float?
  latitude                Float?
  longitude               Float?
  workload                Int                       @default(0) // Number of active work orders
  hourlyRate              Float?
  stripeAccountId         String?                   @unique // For Stripe Connect payouts
  payments                VendorPayment[]
  VendorPerformanceRating VendorPerformanceRating[]
}

enum VendorAvailability {
  AVAILABLE
  UNAVAILABLE
  ON_VACATION
}

model WorkOrder {
  id                      String                    @id @default(uuid())
  title                   String
  description             String
  status                  WorkOrderStatus           @default(OPEN)
  priority                Priority
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  completedAt             DateTime?
  maintenanceRequest      MaintenanceRequest        @relation(fields: [maintenanceRequestId], references: [id])
  maintenanceRequestId    String                    @unique
  assignments             WorkOrderAssignment[]
  quotes                  WorkOrderQuote[]
  costEstimation          CostEstimation?
  scheduledEvent          ScheduledEvent?
  vendorPayments          VendorPayment[]
  VendorPerformanceRating VendorPerformanceRating[]
}

enum WorkOrderStatus {
  OPEN
  ASSIGNED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

model WorkOrderAssignment {
  id          String    @id @default(uuid())
  workOrder   WorkOrder @relation(fields: [workOrderId], references: [id])
  workOrderId String
  vendor      Vendor    @relation(fields: [vendorId], references: [id])
  vendorId    String
  assignedAt  DateTime  @default(now())
  notes       String?
}

model WorkOrderQuote {
  id          String      @id @default(uuid())
  workOrder   WorkOrder   @relation(fields: [workOrderId], references: [id])
  workOrderId String
  vendor      Vendor      @relation(fields: [vendorId], references: [id])
  vendorId    String
  amount      Float
  details     String?
  status      QuoteStatus @default(PENDING)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model FollowUp {
  id         String   @id @default(cuid())
  message    Message  @relation(fields: [messageId], references: [id])
  messageId  String   @unique
  status     String
  followUpAt DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Language {
  id        String   @id @default(cuid())
  code      String   @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WhiteLabelConfig {
  id        String     @id @default(cuid())
  token     String     @unique
  platform  String // 'ios' or 'android'
  user      User       @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  Property  Property[]

  @@index([userId])
}

model TenantRating {
  id        String   @id @default(cuid())
  leaseId   String
  lease     Lease    @relation(fields: [leaseId], references: [id])
  tenantId  String
  tenant    User     @relation("RatedTenant", fields: [tenantId], references: [id])
  raterId   String
  rater     User     @relation("Rater", fields: [raterId], references: [id])
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([leaseId])
  @@index([tenantId])
  @@index([raterId])
}

model OnCallSchedule {
  id          String           @id @default(cuid())
  name        String
  description String?
  property    Property         @relation(fields: [propertyId], references: [id])
  propertyId  String
  rotations   OnCallRotation[]
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
}

model OnCallRotation {
  id         String         @id @default(cuid())
  schedule   OnCallSchedule @relation(fields: [scheduleId], references: [id])
  scheduleId String
  user       User           @relation(fields: [userId], references: [id])
  userId     String
  startDate  DateTime
  endDate    DateTime
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
}

enum QuoteStatus {
  PENDING
  ACCEPTED
  REJECTED
}

// Maintenance request model
model MaintenanceRequest {
  id            String                      @id @default(uuid())
  title         String
  description   String
  status        MaintenanceStatus           @default(OPEN)
  priority      Priority                    @default(MEDIUM)
  createdAt     DateTime                    @default(now())
  updatedAt     DateTime                    @updatedAt
  scheduledDate DateTime?
  completedDate DateTime?
  notes         String?                     @db.Text
  property      Property                    @relation(fields: [propertyId], references: [id])
  propertyId    String
  unit          Unit                        @relation(fields: [unitId], references: [id])
  unitId        String
  requestedBy   User                        @relation("RequestedBy", fields: [requestedById], references: [id])
  requestedById String
  workOrder     WorkOrder?
  estimatedCost Float?
  actualCost    Float?
  documents     Document[]
  messages      Message[]
  photoAnalysis PhotoAnalysis?
  category      MaintenanceRequestCategory? @relation(fields: [categoryId], references: [id])
  categoryId    String?
  responseTime  MaintenanceResponseTime?

  @@index([status])
  @@index([priority])
  @@index([propertyId])
  @@index([unitId])
}

enum MaintenanceStatus {
  OPEN
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  EMERGENCY
}

enum Sentiment {
  POSITIVE
  NEGATIVE
  NEUTRAL
}

model Role {
  id          String       @id @default(cuid())
  name        String       @unique
  permissions Permission[]
  // This 'users' field is the other side of the many-to-many relationship with the User model.
  users       User[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Permission {
  id        String   @id @default(cuid())
  name      String   @unique
  roles     Role[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Message model
model Message {
  id             String     @id @default(uuid())
  content        String     @db.Text
  createdAt      DateTime   @default(now())
  isRead         Boolean    @default(false)
  sentiment      Sentiment?
  followUp       FollowUp?
  conversationId String

  sender      User   @relation("SentMessages", fields: [senderId], references: [id])
  senderId    String
  recipient   User   @relation("ReceivedMessages", fields: [recipientId], references: [id])
  recipientId String

  maintenanceRequest   MaintenanceRequest? @relation(fields: [maintenanceRequestId], references: [id])
  maintenanceRequestId String?

  conversation Conversation @relation(fields: [conversationId], references: [id])
}

model Conversation {
  id        String    @id @default(cuid())
  messages  Message[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

// Notification model
model Notification {
  id        String           @id @default(uuid())
  message   String
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())
  type      NotificationType @default(GENERAL)
  user      User             @relation(fields: [userId], references: [id])
  userId    String

  @@index([userId])
}

enum NotificationType {
  GENERAL
  MAINTENANCE
  PAYMENT
  ANNOUNCEMENT
}

// Transaction model
model Transaction {
  id            String            @id @default(uuid())
  amount        Float
  type          TransactionType
  status        TransactionStatus
  description   String?
  createdAt     DateTime          @default(now())
  processedAt   DateTime?
  paymentMethod String?
  reference     String? // External reference number
  lease         Lease             @relation(fields: [leaseId], references: [id])
  leaseId       String

  @@index([leaseId])
}

enum TransactionType {
  RENT
  FEE
  DEPOSIT
  REFUND
  OTHER
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
}

model Listing {
  id             String        @id @default(uuid())
  title          String
  description    String
  rent           Float
  isAvailable    Boolean       @default(true)
  dateAvailable  DateTime
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  property       Property      @relation(fields: [propertyId], references: [id])
  propertyId     String
  postedBy       User          @relation(fields: [postedById], references: [id])
  postedById     String
  units          Unit[]
  slug           String        @unique
  photoGallery   Photo[]
  virtualTourUrl String?
  contactInfo    String?
  amenities      String[]
  leaseTerms     String?
  applicationFee Float?
  status         ListingStatus @default(ACTIVE)
  Application    Application[]

  @@index([propertyId])
}

model Application {
  id                String            @id @default(uuid())
  status            ApplicationStatus @default(PENDING)
  submittedAt       DateTime          @default(now())
  applicant         User              @relation(fields: [applicantId], references: [id])
  applicantId       String
  listing           Listing           @relation(fields: [listingId], references: [id])
  listingId         String
  notes             String?
  backgroundCheckId String?
  creditScore       Int?
  income            Float?
  employmentStatus  String?
  BackgroundCheck   BackgroundCheck?
  Screening         Screening?
  RiskAssessment    RiskAssessment?

  @@index([applicantId])
  @@index([listingId])
}

enum ApplicationStatus {
  PENDING
  REVIEW
  APPROVED
  REJECTED
}

model MarketData {
  id                 String   @id @default(uuid())
  location           String
  averageRent        Float
  vacancyRate        Float
  dateRecorded       DateTime @default(now())
  propertyType       String
  bedroomCount       Int
  demandScore        Float
  supplyScore        Float
  rentalYield        Float
  pricePerSqFt       Float
  yearOverYearGrowth Float

  @@index([location])
  @@index([propertyType])
}

model OAuthConnection {
  id           String   @id @default(uuid())
  provider     String // e.g., 'google', 'facebook'
  providerId   String
  accessToken  String
  refreshToken String?
  scopes       String[]
  user         User     @relation(fields: [userId], references: [id])
  userId       String

  @@unique([provider, providerId])
}

model AIImageAnalysis {
  id                   String   @id @default(uuid())
  imageUrl             String
  analysisResult       Json
  analyzedAt           DateTime @default(now())
  maintenanceRequestId String?
}

model KnowledgeBaseEntry {
  id        String   @id @default(uuid())
  question  String
  answer    String
  category  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
}

model VendorPerformanceRating {
  id          String    @id @default(uuid())
  score       Int
  comments    String?
  ratedAt     DateTime  @default(now())
  vendor      Vendor    @relation(fields: [vendorId], references: [id])
  vendorId    String
  workOrder   WorkOrder @relation(fields: [workOrderId], references: [id])
  workOrderId String
  ratedBy     User      @relation(fields: [ratedById], references: [id])
  ratedById   String

  @@index([vendorId])
  @@index([workOrderId])
}

model BackgroundCheck {
  id                String      @id @default(uuid())
  status            String
  reportUrl         String?
  checkedAt         DateTime    @default(now())
  application       Application @relation(fields: [applicationId], references: [id])
  applicationId     String      @unique
  criminalHistory   String?
  creditHistory     String?
  evictionHistory   String?
  employmentHistory String?
}

model AuditEntry {
  id        String   @id @default(uuid())
  action    String
  details   Json
  timestamp DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
  userId    String

  @@index([userId])
}

model SocialMediaPlatformConfig {
  id           String   @id @default(uuid())
  platformName String   @unique
  apiKey       String
  apiSecret    String
  accessToken  String
  refreshToken String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model PredictiveMaintenance {
  id                String   @id @default(uuid())
  description       String
  urgency           String
  confidence        Float
  recommendedAction String
  createdAt         DateTime @default(now())
  unit              Unit     @relation(fields: [unitId], references: [id])
  unitId            String

  @@index([unitId])
}

model CostEstimation {
  id              String    @id @default(uuid())
  estimatedCost   Float
  confidenceScore Float
  estimationDate  DateTime  @default(now())
  workOrder       WorkOrder @relation(fields: [workOrderId], references: [id])
  workOrderId     String    @unique
  materialsCost   Float?
  laborCost       Float?
  notes           String?
}

model PhotoAnalysis {
  id                   String             @id @default(uuid())
  imageUrl             String
  analysisResult       Json
  analyzedAt           DateTime           @default(now())
  maintenanceRequest   MaintenanceRequest @relation(fields: [maintenanceRequestId], references: [id])
  maintenanceRequestId String             @unique
}

model MaintenanceRequestCategory {
  id                  String               @id @default(uuid())
  name                String               @unique
  description         String?
  maintenanceRequests MaintenanceRequest[]
}

model EmergencyRoutingRule {
  id        String   @id @default(uuid())
  keyword   String
  priority  Int
  vendor    Vendor   @relation(fields: [vendorId], references: [id])
  vendorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MaintenanceResponseTime {
  id                   String             @id @default(uuid())
  acknowledgedAt       DateTime?
  resolvedAt           DateTime?
  maintenanceRequest   MaintenanceRequest @relation(fields: [maintenanceRequestId], references: [id])
  maintenanceRequestId String             @unique
}

model ScheduledEvent {
  id          String    @id @default(uuid())
  title       String
  description String?
  startTime   DateTime
  endTime     DateTime
  workOrder   WorkOrder @relation(fields: [workOrderId], references: [id])
  workOrderId String    @unique
}

model Screening {
  id            String      @id @default(uuid())
  result        String
  details       Json
  conductedAt   DateTime    @default(now())
  application   Application @relation(fields: [applicationId], references: [id])
  applicationId String      @unique
}

model RiskAssessment {
  id            String      @id @default(uuid())
  score         Float
  level         String
  details       Json
  assessedAt    DateTime    @default(now())
  application   Application @relation(fields: [applicationId], references: [id])
  applicationId String      @unique
}

model TenantIssuePrediction {
  id          String   @id @default(uuid())
  prediction  String
  confidence  Float
  details     Json
  predictedAt DateTime @default(now())
  tenant      User     @relation(fields: [tenantId], references: [id])
  tenantId    String

  @@index([tenantId])
}

model DbOptimizationLog {
  id         String   @id @default(cuid())
  timestamp  DateTime @default(now())
  level      String // e.g., INFO, WARN, ERROR
  message    String
  details    Json?
  durationMs Int? // Duration of the optimization task in milliseconds
  operation  String // e.g., 'index_creation', 'query_rewrite', 'vacuum'
  status     String // e.g., 'SUCCESS', 'FAILURE'
}

model EscalationPolicy {
  id          String                 @id @default(cuid())
  name        String
  description String?
  property    Property               @relation(fields: [propertyId], references: [id])
  propertyId  String
  rules       EscalationPolicyRule[]
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
}

model EscalationPolicyRule {
  id        String           @id @default(cuid())
  policy    EscalationPolicy @relation(fields: [policyId], references: [id])
  policyId  String
  user      User             @relation(fields: [userId], references: [id])
  userId    String
  order     Int
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
}

model ApiKey {
  id          String    @id @default(cuid())
  key         String    @unique
  user        User      @relation(fields: [userId], references: [id])
  userId      String
  permissions String[]
  expiresAt   DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([userId])
}

model Photo {
  id        String  @id @default(cuid())
  url       String
  caption   String?
  listing   Listing @relation(fields: [listingId], references: [id])
  listingId String

  @@index([listingId])
}

enum ListingStatus {
  ACTIVE
  INACTIVE
  RENTED
  DRAFT
}

model BusinessHours {
  id         String   @id @default(cuid())
  dayOfWeek  String // e.g., "Monday", "Tuesday"
  openTime   String // e.g., "09:00"
  closeTime  String // e.g., "17:00"
  property   Property @relation(fields: [propertyId], references: [id])
  propertyId String

  @@index([propertyId])
}

model EmergencyProtocol {
  id          String   @id @default(cuid())
  name        String
  description String
  property    Property @relation(fields: [propertyId], references: [id])
  propertyId  String

  @@index([propertyId])
}

model Appliance {
  id                 String    @id @default(cuid())
  name               String
  brand              String?
  model              String?
  purchaseDate       DateTime?
  warrantyExpiryDate DateTime?
  unit               Unit      @relation(fields: [unitId], references: [id])
  unitId             String

  @@index([unitId])
}

model Consent {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  consent   Boolean
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ModelPerformance {
  id          String   @id @default(cuid())
  modelName   String
  accuracy    Float?
  precision   Float?
  recall      Float?
  f1Score     Float?
  recordedAt  DateTime @default(now())
  version     String?
  datasetInfo String?
  parameters  Json?
  notes       String?  @db.Text

  @@index([modelName])
  @@index([recordedAt])
}

model Device {
  id        String   @id @default(cuid())
  token     String   @unique
  platform  String // 'ios' or 'android'
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model VendorPayment {
  id            String        @id @default(cuid())
  amount        Float
  status        PaymentStatus @default(PENDING)
  processedAt   DateTime?
  notes         String?
  workOrder     WorkOrder     @relation(fields: [workOrderId], references: [id])
  workOrderId   String        @unique
  vendor        Vendor        @relation(fields: [vendorId], references: [id])
  vendorId      String
  transactionId String? // To store the Stripe transaction ID
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

enum PaymentStatus {
  PENDING
  PROCESSING
  PAID
  FAILED
}
