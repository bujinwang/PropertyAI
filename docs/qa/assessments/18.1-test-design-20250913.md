# Test Design: Story 18.1

Date: 2025-09-13
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 12 (67%)
- Integration tests: 4 (22%)
- E2E tests: 2 (11%)
- Priority distribution: P0: 8, P1: 6, P2: 4

## Test Scenarios by Acceptance Criteria

### AC1: Tenant Profile Scoring

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-UNIT-001 | Unit        | P0       | scoreTenant calculates financial score correctly | Core business logic      |
| 18.1-UNIT-002 | Unit        | P0       | scoreTenant handles missing income gracefully | Error handling           |
| 18.1-UNIT-003 | Unit        | P1       | scoreTenant updates matchingProfile in DB | Data persistence         |
| 18.1-INT-001  | Integration | P0       | scoreTenant integrates with tenantService | Component interaction    |

### AC2: Property Suitability Analysis

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-UNIT-004 | Unit        | P0       | scoreProperty computes location match | Key matching factor      |
| 18.1-UNIT-005 | Unit        | P0       | scoreProperty validates price range | Financial criteria       |
| 18.1-UNIT-006 | Unit        | P1       | scoreProperty handles missing amenities | Edge case coverage       |
| 18.1-INT-002  | Integration | P0       | scoreProperty updates property model | DB integration           |

### AC3: Matching Algorithm

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-UNIT-007 | Unit        | P0       | generateMatches computes cosine similarity | ML core algorithm        |
| 18.1-UNIT-008 | Unit        | P0       | generateMatches sorts by score descending | Ranking correctness      |
| 18.1-UNIT-009 | Unit        | P1       | generateMatches creates MarketplaceMatch records | Data creation            |
| 18.1-INT-003  | Integration | P0       | generateMatches calls scoreTenant and scoreProperty | Multi-service flow       |
| 18.1-E2E-001  | E2E         | P0       | End-to-end match generation and DB storage | Full workflow            |

### AC4: Owner Preference Integration

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-UNIT-010 | Unit        | P1       | scoreProperty applies custom criteria | Customization            |
| 18.1-INT-004  | Integration | P1       | generateMatches respects owner filters | Integration with prefs   |

### AC5: Recommendation Engine

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-UNIT-011 | Unit        | P1       | generateMatches generates recommendation reasons | Explainability           |
| 18.1-UNIT-012 | Unit        | P2       | runABTest compares variants | Optimization framework   |

### AC6: Performance (<5s for 100 matches)

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-PERF-001| Performance | P0       | Load test generateMatches with 100 properties | SLA compliance           |

### AC7: Bias Mitigation (<2% parity)

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-UNIT-013 | Unit        | P0       | generateMatches checks demographic parity | Fair housing compliance  |

### AC8: API Endpoints

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-UNIT-014 | Unit        | P1       | /match endpoint validation | Input security           |
| 18.1-E2E-002  | E2E         | P1       | API to DB flow for matches | End-to-end integration   |

### AC9: Error Handling

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-UNIT-015 | Unit        | P0       | scoreTenant throws on invalid ID | Robustness               |
| 18.1-UNIT-016 | Unit        | P0       | generateMatches handles DB errors | Reliability              |

### AC10: Scalability (1000+ requests)

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-PERF-002| Performance | P1       | Load test with concurrent requests | Scalability              |

### AC11: Security (No PII in vectors)

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-UNIT-017 | Unit        | P0       | Vector generation anonymizes PII | Privacy compliance       |

### AC12: Audit Logging

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-INT-005  | Integration | P2       | generateMatches logs matches | Audit trail              |

### AC13: Load Testing

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 18.1-PERF-003| Performance | P1       | Simulate 1000 concurrent matches | High load validation     |

## Risk Coverage

- Security: P0 tests for PII anonymization and auth
- Performance: Dedicated load tests for SLAs
- Reliability: Error handling across services
- Maintainability: Unit tests for all core functions

## Recommended Execution Order

1. P0 Unit tests (fail fast)
2. P0 Integration tests
3. P0 E2E tests
4. P1 tests in order
5. Performance tests
6. P2 tests as time permits