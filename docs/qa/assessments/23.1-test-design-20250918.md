# Test Design: Story 23.1 - Mobile Dashboard Optimization

Date: 2025-09-18
Story: 23.1 - Mobile Dashboard Optimization

## Test Strategy Overview

This test design covers unit, integration, and E2E tests for responsive layout, touch interactions, offline caching, and performance. Target 100% coverage for new code, regression for Epic 21.

### P0 Scenarios (Must Have)
1. **Responsive Layout (AC1)**
   - Verify MobileOptimizer applies Tailwind classes on <768px (grid-cols-1, p-2, bg-gray-100).
   - Test: Jest unit for component with mocked matchMedia (mobile true/false); Cypress E2E on 375x667 viewport, assert classes and content adaptation.
   - Edge: Borderline 768px change, nested responsive in PropertyDetail (tabs stack).

2. **Touch Gestures (AC2)**
   - Verify swipe handling (touchstart/move/end events, threshold 100px, console log or navigation).
   - Test: Jest unit with fireEvent.touch for left/right swipe, assert isSwiping false after threshold.
   - E2E: Cypress trigger touch on .swipe-area, assert class or location change; test target size â‰¥48px on buttons.

3. **Offline Caching (AC3)**
   - Verify service worker registration in index.tsx, sw.js caching for /api/predictive-maintenance.
   - Test: Jest mock navigator.serviceWorker.register, assert called with '/sw.js'.
   - Integration: Mock fetch/caches.open, verify put in cache; IndexedDB open/put for dashboardData.
   - E2E: Cypress intercept API, go offline (win.navigator.onLine = false), reload, assert cached content renders.

4. **Performance <3s (AC4)**
   - Verify Lighthouse CLI on mobile emulation (375x667), score >90, load <3s.
   - Test: Manual Lighthouse run on PredictiveMaintenanceDashboard; Jest with Performance API mock for timing.

### P1 Scenarios (High Priority)
1. **Desktop Unchanged (AC5)**
   - Regression: Jest snapshot for desktop viewport, assert no mobile classes.

2. **API Integration Offline/Online (AC7)**
   - Test: Integration with predictiveMaintenanceService fetch, mock offline, verify cache fallback.

### P2 Scenarios (Medium Priority)
1. **No Regressions (AC10)**
   - Run full Epic 21 suite (deno test -A), assert pass.

## Test Types and Coverage
- **Unit Tests**: 80% - Hooks (useMediaQuery, touch events), caching logic.
- **Integration Tests**: 20% - SW registration, IndexedDB with API mocks.
- **E2E Tests**: 100% - Cypress mobile flows (visit, swipe, offline, Lighthouse).
- **Performance Tests**: Lighthouse CI integration for <3s.

## Test Data Requirements
- Mock API responses (maintenance-data.json for fetch).
- Fixtures for Cypress (alerts, properties).
- Mocked navigator/caches for offline.

## Risks and Mitigations
- Risk: Browser compatibility for matchMedia/touch (Safari/iOS). Mitigation: Cross-browser testing in Cypress.
- Risk: SW caching race conditions. Mitigation: Wait for cache.put in tests.

Coverage Target: 100% for new code (nyc report).