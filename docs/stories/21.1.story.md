# Story 21.1: Predictive Maintenance System

## Status: Done

## Story

As a property owner,
I want predictive maintenance alerts based on AI analysis,
so that I can perform preventive maintenance and reduce costly repairs.

## Acceptance Criteria

1. AI model analyzes property data (age, usage, maintenance history) to predict maintenance needs
2. Automated alerts sent 30 days before predicted failure
3. Dashboard shows maintenance predictions with confidence scores
4. Historical accuracy tracking for model improvement
5. Alerts include cost estimates and priority levels
6. Integration with existing maintenance scheduling system
7. Model accuracy >75% based on historical data
8. Real-time updates as new data becomes available

## Dev Notes

**Previous Story Insights:** Builds on Epic 20 analytics foundation; extend with ML models.

**Data Models:** Use existing Property/Tenant models; add MaintenanceHistory table for training data.

**API Specifications:** POST /api/analytics/predict-maintenance â€“ Body: {propertyId}; Returns: predictions array with dates, types, confidence.

**Component Specifications:** Add MaintenanceAlerts component to dashboard; use existing chart libraries.

**File Locations:** Extend analyticsService.js with predictMaintenance; new: src/models/MaintenanceHistory.js, dashboard/src/components/MaintenanceAlerts.tsx.

**Testing Requirements:** Unit for prediction logic, integration for API, accuracy tests with historical data.

**Technical Constraints:** ML model runs daily; predictions cached for performance; confidence threshold 70%.

## Tasks / Subtasks

- [x] Task 1: Create maintenance history data model
  - [x] Design MaintenanceHistory schema
  - [x] Add migration script
  - [x] Seed with historical data

- [x] Task 2: Implement predictive ML model
  - [x] Train model on historical maintenance data
  - [x] Implement prediction algorithm
  - [x] Add confidence scoring

- [x] Task 3: API for maintenance predictions
  - [x] Add predict-maintenance endpoint
  - [x] Implement caching for performance
  - [x] Add error handling

- [x] Task 4: Frontend maintenance alerts
  - [x] Create MaintenanceAlerts component
  - [x] Integrate with dashboard
  - [x] Add alert notifications

- [x] Task 5: Testing and validation
  - [x] Unit tests for prediction logic
  - [x] Integration tests for API
  - [x] Accuracy validation with test data

## Dev Agent Record

**Agent Model Used:** openrouter/sonoma-sky-alpha

**Debug Log References:** N/A

**Completion Notes List:**
- ML model uses pattern recognition algorithm based on historical maintenance intervals.
- Maintenance history data model created with comprehensive schema including cost tracking.
- API endpoint includes caching for performance optimization.
- Frontend component provides real-time alerts with confidence scoring.
- Comprehensive test suite covers unit, integration, and accuracy validation.

**File List:**
- src/models/Property.js (new)
- src/config/database.js (new)
- src/models/MaintenanceHistory.js (new)
- src/models/migrations/20250914-create-maintenance-history.js (new)
- src/models/seed-maintenance-history.js (new)
- src/services/analyticsService.js (modified)
- src/routes/analytics.js (modified)
- dashboard/src/services/predictiveMaintenanceService.ts (modified)
- dashboard/src/components/MaintenanceAlerts.tsx (new)
- dashboard/src/pages/PredictiveMaintenanceDashboard.tsx (modified)
- tests/analyticsService.test.js (modified)
- tests/analyticsRoutes.test.js (new)

**Change Log:**
- 2025-09-14: Initial draft for predictive maintenance.
- 2025-09-14: Implementation completed with full test coverage.
- 2025-09-14: QA review passed - story marked as Done.