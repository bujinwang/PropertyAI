# Story 21.2: Tenant Churn Prediction Model

## Status: Draft

## Story

As a property manager,
I want ML models to predict tenant churn risk,
So that I can implement retention strategies proactively.

## Acceptance Criteria

1. ML model analyzes tenant data (payment history, lease duration, complaints) to predict churn probability
2. Risk scoring dashboard shows tenants at high/medium/low churn risk
3. Automated alerts for tenants with >70% churn probability
4. Historical accuracy tracking for model improvement
5. Retention recommendations based on churn factors
6. Integration with existing tenant management system
7. Model accuracy >75% based on historical data
8. Real-time risk updates as new data becomes available

## Dev Notes

**Previous Story Insights:** Builds on Epic 21 analytics foundation; extend with ML models.

**Data Models:** Use existing Tenant model; add churn-related fields if needed.

**API Specifications:** POST /api/analytics/predict-churn â€“ Body: {tenantId}; Returns: risk assessment with probability and factors.

**Component Specifications:** Add ChurnRiskAlerts component to tenant dashboard; use existing chart libraries.

**File Locations:** Extend analyticsService.js with predictChurn; new: dashboard/src/components/ChurnRiskAlerts.tsx.

**Testing Requirements:** Unit for churn logic, integration for API, accuracy tests with historical data.

**Technical Constraints:** ML model runs daily; predictions cached for performance; confidence threshold 70%.

## Tasks / Subtasks

- [x] Task 1: Create churn prediction model
  - [x] Design churn risk algorithm
  - [x] Implement prediction logic
  - [x] Add confidence scoring

- [x] Task 2: API for churn predictions
  - [x] Add predict-churn endpoint
  - [x] Implement caching for performance
  - [x] Add error handling

- [x] Task 3: Frontend churn risk alerts
  - [x] Create ChurnRiskAlerts component
  - [x] Integrate with tenant dashboard
  - [x] Add alert notifications

- [x] Task 4: Testing and validation
  - [x] Unit tests for churn logic
  - [x] Integration tests for API
  - [x] Accuracy validation with test data

## Dev Agent Record

**Agent Model Used:** openrouter/sonoma-sky-alpha

**Debug Log References:** N/A

**Completion Notes List:**
- ML model uses weighted algorithm analyzing payment patterns, lease duration, and screening risk.
- Churn prediction includes confidence scoring and retention recommendations.
- API endpoint includes caching for performance optimization.
- Frontend component provides comprehensive risk assessment with visual indicators.
- Comprehensive test suite covers unit, integration, and accuracy validation.

**File List:**
- src/services/analyticsService.js (modified)
- src/routes/analytics.js (modified)
- dashboard/src/components/ChurnRiskAlerts.tsx (new)
- dashboard/src/pages/TenantDetail.tsx (modified)
- tests/analyticsService.test.js (modified)
- tests/analyticsRoutes.test.js (new)

**Change Log:**
- 2025-09-14: Initial draft for tenant churn prediction.